import{__decorate as e}from"tslib";import{onAnyKey as t,onKey as i,nextInArray as r,previousInArray as n,arrayHead as s,arrayTail as a,syncProps as c,isVisible as l,baseStyles as d,state as o,property as h,querySlot as p,querySlotAll as v}from"@cds/core/internal";import{LitElement as m,html as u}from"lit";import{CdsTreeItem as b}from"./tree-item.element.js";import f from"./tree.element.scss.js";class A extends m{constructor(){super(...arguments),this.role="tree",this.multiSelect=!1,this.ariaMultiSelectable="false",this.keyboardNavigationHandler=e=>{const c=this.currentActiveItem;c&&c instanceof b&&(t(["arrow-left","arrow-right","arrow-up","arrow-down","home","end","enter","space"],e,(()=>{e.preventDefault()})),i("arrow-left",e,(()=>{if(c.expandable&&c.expanded)c.expandedChange.emit(!1);else{const e=c.parentElement;e&&e instanceof b&&this.setAriaActiveDescendant(e)}})),i("arrow-right",e,(()=>{c.expandable&&(c.expanded?this.setAriaActiveDescendant(r(c,this.visibleChildren)):c.expandedChange.emit(!0))})),i("arrow-down",e,(()=>{c&&this.setAriaActiveDescendant(r(c,this.visibleChildren))})),i("arrow-up",e,(()=>{c&&this.setAriaActiveDescendant(n(c,this.visibleChildren))})),i("home",e,(()=>{c&&this.setAriaActiveDescendant(s(this.visibleChildren))})),i("end",e,(()=>{c&&this.setAriaActiveDescendant(a(this.visibleChildren))})),i("enter",e,(()=>{c.anchorLink&&c.anchorLink.click(),c.expandable&&c.expandedChange.emit(!c.expanded)})),i("space",e,(()=>{c.anchorLink&&c.anchorLink.click(),c&&!c.disabled&&c.selectedChange.emit(!c.selected)})))}}connectedCallback(){super.connectedCallback(),this.tabIndex=0,this.addEventListener("focus",this.initAriaActiveDescendant),this.addEventListener("click",this.clickHandler),this.addEventListener("keydown",this.keyboardNavigationHandler)}disconnectedCallback(){super.disconnectedCallback()}updated(e){super.updated(e),this.ariaMultiSelectable=this.multiSelect?"true":"false",this.childrenItems.forEach((e=>c(e,this,{multiSelect:this.multiSelect})))}clickHandler(e){if(e.target instanceof b){const t=this.visibleChildren.find((t=>t===e.target));t&&this.setAriaActiveDescendant(t)}}get currentActiveItem(){return this.visibleChildren.find((e=>e.id===this.ariaActiveDescendant))}initAriaActiveDescendant(){if(!this.currentActiveItem){const e=this.visibleChildren.find((e=>e.selected))||this.firstChildItem;e&&this.setAriaActiveDescendant(e)}}setAriaActiveDescendant(e){e&&(this.ariaActiveDescendant=e.id,e.focus())}get visibleChildren(){return Array.from(this.childrenItems).filter((e=>l(e)))}render(){return u`<slot></slot>`}static get styles(){return[d,f]}}e([o({type:String,reflect:!0,attribute:"role"})],A.prototype,"role",void 0),e([h({type:Boolean,attribute:"multi-select"})],A.prototype,"multiSelect",void 0),e([o({type:String,reflect:!0,attribute:"aria-activedescendant"})],A.prototype,"ariaActiveDescendant",void 0),e([o({type:String,reflect:!0,attribute:"aria-multiselectable"})],A.prototype,"ariaMultiSelectable",void 0),e([p("cds-tree-item")],A.prototype,"firstChildItem",void 0),e([v("cds-tree-item")],A.prototype,"childrenItems",void 0);export{A as CdsTree};
//# sourceMappingURL=tree.element.js.map
